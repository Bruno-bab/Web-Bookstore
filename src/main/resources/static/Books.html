<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Bookstore</title>
</head>
<body>
    <h1>List of books</h1>
    <ul id="bookList"></ul>
    <button type="button" id="newBook">Add new book</button>
    <button type="button" id="newOrder">Place new orders</button>
    <button type="button" id="goToOrders">View orders</button>
    <br/><br/><br/>
    <form id="searchForm">
        <input type="text" id="authorName" placeholder="Author name" required/><br/>
        <button type="submit">Find by author</button>
        <button type="button" id="showAll">Show all books</button>
    </form>

    <script>
        document.getElementById("newBook").addEventListener("click", function() {
            window.location.href = "http://localhost:8080/NewBook.html";
        });
        document.getElementById("newOrder").addEventListener("click", function() {
            window.location.href = "http://localhost:8080/newOrder.html";
        });
        document.getElementById("goToOrders").addEventListener("click", function() {
            window.location.href = "http://localhost:8080/orders.html";
        });
        document.getElementById("showAll").addEventListener("click", function() {
            document.getElementById("authorName").value = "";
            loadBooks();
        });

        async function loadBooks() {
            const response = await fetch("/books");
            const books = await response.json();
            renderBooks(books);
        }

        // Load books by author
        async function loadBooksByAuthor(authorName) {
            const response = await fetch("/books/author/" + encodeURIComponent(authorName));
            const books = await response.json();
            renderBooks(books);
        }

        // Render books into <ul>
        function renderBooks(books) {
            const list = document.getElementById("bookList");
            list.innerHTML = "";
            if (books.length === 0) {
                list.innerHTML = "<li>No books found.</li>";
                return;
            }
            books.forEach(book => {
                const li = document.createElement("li");
                li.textContent = `${book.id} | ${book.title} | ${book.author} | ${book.price} euros`;
                list.appendChild(li);
            });
        }

        document.getElementById("searchForm").addEventListener("submit", function(event) {
            event.preventDefault();
            const authorName = document.getElementById("authorName").value.trim();
            if (authorName)
                loadBooksByAuthor(authorName);
            else
                loadBooks();
        });
        loadBooks();
    </script>
</body>
</html>